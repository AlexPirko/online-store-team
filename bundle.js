(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class e{constructor(t){this.container=document.createElement("div"),this.container.id=t}createHeaderTitle(t){const e=document.createElement("h1");return e.innerText=t,e}render(){return this.container}}e.textObject={};class s extends e{render(){const t=this.createHeaderTitle(s.textObject.MainTitle);return this.container.append(t),this.container}}s.textObject={MainTitle:"Home Page"};class i{constructor(t,e){this.container=document.createElement(t),this.container.classList.add(e)}render(){return this.container}}class n extends i{constructor(t,e,s,i,n){super(t,e),this.incItemHandler=()=>{this.cart.incItem(this.item.id),this.updateCartItem()},this.decItemHandler=()=>{this.cart.decItem(this.item.id),this.updateCartItem(),0===this.item.cnt&&this.container.remove()},this.updateCartItem=()=>{const t=this.container.querySelector(".cart-item-value"),e=this.container.querySelector(".cart-item-total");t.textContent=String(this.item.cnt),e.textContent=(this.item.cnt||1)*this.item.price+"$"},this.cart=s,this.item=i,this.number=n}render(){const t=`\n      <div>\n        <span class='cart-item-number'>${this.number}</span>\n        <div class='cart-img-wrap'>\n          <img src='${this.item.images[0]}'>\n        </div>\n        <div class='cart-item-info'>\n          <h4>${this.item.title}</h4>\n          <p>Rating: ${this.item.rating}</p>\n          <p>Brand: ${this.item.brand} / Category: ${this.item.category}</p>\n          <p>${this.item.description.slice(0,40)}...</p>\n        </div>\n      </div>\n      <div class='controls'>\n        <div class='cart-item-stock'>Stock: ${this.item.stock}</div>\n        <div>\n          <button class='cart-item-dec'>-</button>\n          <span class='cart-item-value'>${this.item.cnt||1}</span>\n          <button class='cart-item-inc'>+</button>\n        </div>\n        <div class='cart-item-total'>${(this.item.cnt||1)*this.item.price}$</div>\n      </div>\n    `;this.container.innerHTML=t;const e=this.container.querySelector(".cart-item-inc"),s=this.container.querySelector(".cart-item-dec");return e?.addEventListener("click",this.incItemHandler),s?.addEventListener("click",this.decItemHandler),this.container}}class a extends i{constructor(t,e,s){super(t,e),this.cart=s}render(){const t=[];this.cart.items.forEach(((e,s)=>{const i=new n("div","cart-item",this.cart,e,s+1).render();t.push(i)}));const{page:e,limit:s}=this.cart.opts,i=(e-1)*s,a=e*s,r=t.slice(i,a);return this.container.append(...r),this.container}}class r extends i{constructor(t,e,s){super(t,"applied-code-item"),this.cart=s,this.codename=e}render(){const t=`\n    <p> Code: <span>'${this.codename}'</span></p>\n    <div>\n      <span>${this.cart.promocode[this.codename]} % </span> \n      <button class='code-remove-button'>Remove</button>\n    </div>\n    `;return this.container.innerHTML=t,this.container.querySelector(".code-remove-button")?.addEventListener("click",(()=>this.cart.removePromoCode(this.codename))),this.container}}class c extends i{constructor(t,e,s){super(t,"promo-item"),this.cart=s,this.codename=e}render(){const t=`\n      <p>${this.codename} - ${this.cart.promocode[this.codename]}%</p>\n      <button class='promo-add-button'>Add</button>\n    `;this.container.innerHTML=t;const e=this.container.querySelector(".promo-add-button");return e.addEventListener("click",(()=>{this.cart.setPromoCode(this.codename),e.classList.add("hide")})),this.container}}class o extends i{constructor(t,e,s){super(t,e),this.promoInputHandler=t=>{const e=t.target.value,s=this.container.querySelector(".find-promo");if(s.innerHTML="",this.checkCodeExist(e)){const t=new c("div",e,this.cart).render();-1!==this.cart.appliedCodes.indexOf(e)&&t.querySelector("button").classList.add("hide"),s?.append(t)}},this.cart=s}checkCodeExist(t){return Object.keys(this.cart.promocode).some((e=>e===t))}openModal(){this.cart.toggleModal(),console.log("Open Modal")}render(){const t=`\n      <h3 class='summary-title'>Summary</h3>\n      <p class='summary-products'>Products: ${this.cart.getTotalCount()}<p>\n      <p class='summary-total'>Total: ${this.cart.getTotalPrice()}$<p>\n      <p class='summary-discount'>Total: ${this.cart.getDiscountPrice()}$<p>\n      <div class='applied-codes-wrap'>\n        <h3>Applied codes</h3>\n        <div class='applied-items'></div>\n      </div>\n      <div class='promo-wrap'>\n      <input id='promocode' type='text' placeholder='enter promo code'>\n      </div>\n      <p class='test-code'>Promo for test: '<span>js</span>', '<span>rs22</span>', '<span>css</span>'</p>\n      <div class='find-promo'></div>\n      <button class='buy-now'>BUY NOW</button>\n    `;if(this.container.innerHTML=t,0===this.cart.appliedCodes.length)this.container.querySelector(".applied-codes-wrap")?.classList.add("hide"),this.container.querySelector(".summary-discount")?.classList.add("hide");else{this.container.querySelector(".summary-total")?.classList.add("disable");const t=this.container.querySelector(".applied-items");this.cart.appliedCodes.forEach((e=>{const s=new r("div",e,this.cart).render();t?.append(s)}))}return this.container.querySelector("#promocode")?.addEventListener("input",this.promoInputHandler),this.container.querySelector(".buy-now")?.addEventListener("click",(()=>{this.openModal()})),this.container}}const d=t.p+"f50535fc30aeca38c731.png",l=t.p+"643f53bdcc2f0c5242e4.png",p=t.p+"91c5a62d8f71a7c51817.jpg",h=t.p+"e3106f5f62be83345de9.png";class u{static checkTextField(t,e,s){t.classList.contains("valid-form")&&t.classList.remove("valid-form");const i=t.value.split(" ");if(i.length<e)return t.classList.add("invalid-form"),!1;for(let e=0;e<i.length;e++)if(void 0!==i[e]&&Number(i[e]?.length)<s)return t.classList.add("invalid-form"),!1;return t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0}static checkPhoneField(t){if(t.classList.contains("valid-form")&&t.classList.remove("valid-form"),t.value.length<10||"+"!==t.value[0])return t.classList.add("invalid-form"),!1;for(let e=1;e<t.value.length;e++)if("number"!=typeof Number(t.value[e]))return!1;return t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0}static checkEmailField(t){return t.classList.contains("valid-form")&&t.classList.remove("valid-form"),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t.value).toLowerCase())?(t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0):(t.classList.add("invalid-form"),!1)}static checkCardField(t){t.classList.contains("valid-form")&&t.classList.remove("valid-form");const e=document.querySelectorAll(".card-img")[0];void 0!==t.value[0]&&(3===Number(t.value[0])?e.src=d:4===Number(t.value[0])?e.src=l:5===Number(t.value[0])?e.src=h:e.src=p);let s=t.value.replace(/[^\d]/g,"").substring(0,16);return s=""!==s?s.match(/.{1,4}/g).join(" "):"",t.value=s,t.value.length>=19?(t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0):(t.classList.add("invalid-form"),!1)}static checkDateField(t){t.classList.contains("valid-form")&&t.classList.remove("valid-form");let e=t.value.replace(/[^\d]/g,"").substring(0,4);return e=""!==e?e.match(/.{1,2}/g).join("/"):"",t.value=e,+t.value.slice(0,2)>12||+t.value.slice(-2)<23?(t.classList.add("invalid-form"),!1):t.value.length>=5?(t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0):(t.classList.add("invalid-form"),!1)}static checkCvvField(t){return t.classList.contains("valid-form")&&t.classList.remove("valid-form"),t.value.length>3&&(t.value=t.value.slice(0,t.value.length-1)),t.value.length>=3?(t.classList.remove("invalid-form"),t.classList.add("valid-form"),!0):(t.classList.add("invalid-form"),!1)}}var m,v;!function(t){t.HomePage="home-page",t.ProductListPage="product-list-page",t.CartPage="cart-page",t.ProductDetails="product-details"}(m||(m={})),function(t){t.Error_404="404"}(v||(v={}));class g extends e{constructor(t,e){super(t),this.cart=e}render(){const t=document.createElement("div");t.className="modal-block";const e=document.createElement("h2");e.className="modal-title",e.innerText="Personal details";const s=document.createElement("div");s.className="input-block";const i=document.createElement("div");i.className="name-block";const n=document.createElement("input");n.className="modul-input input-name",n.placeholder="Your Name",n.type="text",i.append(n),n.addEventListener("input",(()=>{u.checkTextField(n,2,3),i.hasChildNodes()&&void 0!==i.childNodes[1]&&i.removeChild(i.childNodes[1])}));const a=document.createElement("div");a.className="phone-block";const r=document.createElement("input");r.className="modul-input input-phone",r.placeholder="Phone number",r.type="tel",a.append(r),r.addEventListener("input",(()=>{u.checkPhoneField(r),a.hasChildNodes()&&void 0!==a.childNodes[1]&&a.removeChild(a.childNodes[1])}));const c=document.createElement("div");c.className="address-block";const o=document.createElement("input");o.className="modul-input input-address",o.placeholder="Delivery Address",o.type="text",c.append(o),o.addEventListener("input",(()=>{u.checkTextField(o,3,5),c.hasChildNodes()&&void 0!==c.childNodes[1]&&c.removeChild(c.childNodes[1])}));const d=document.createElement("div");d.className="email-block";const l=document.createElement("input");l.className="modul-input input-email",l.placeholder="Your E-mail",l.type="email",d.append(l),l.addEventListener("input",(()=>{u.checkEmailField(l),d.hasChildNodes()&&void 0!==d.childNodes[1]&&d.removeChild(d.childNodes[1])})),s.append(i,a,c,d);const h=document.createElement("h2");h.className="card-title",h.innerText="Credit card details";const v=document.createElement("div");v.className="card-wrap";const g=document.createElement("div");g.className="card-block";const f=document.createElement("div");f.className="number-block";const L=document.createElement("div");L.className="image-wrapper";const y=document.createElement("img");y.className="card-img",y.src=p,y.alt="image card";const b=document.createElement("div");b.className="number-wrapper";const w=document.createElement("input");w.className="modul-input input-number",w.placeholder="Card Number",w.type="text",w.addEventListener("input",(()=>{u.checkCardField(w),b.hasChildNodes()&&void 0!==b.childNodes[1]&&b.removeChild(b.childNodes[1])})),L.append(y),b.append(w),f.append(L,b);const C=document.createElement("div");C.className="info-card";const E=document.createElement("div");E.className="date-block";const S=document.createElement("div");S.className="date-info",S.innerText="DATE:";const $=document.createElement("div");$.className="date-wrapper";const k=document.createElement("input");k.className="modul-input input-date",k.placeholder="MM/YY",k.type="text",k.addEventListener("input",(()=>{u.checkDateField(k),$.hasChildNodes()&&void 0!==$.childNodes[1]&&$.removeChild($.childNodes[1])})),$.append(k),E.append(S,$);const P=document.createElement("div");P.className="cvv-block";const x=document.createElement("div");x.className="cvv-info",x.innerText="CVV:";const T=document.createElement("div");T.className="cvv-wrapper";const N=document.createElement("input");N.className="modul-input input-cvv",N.placeholder="CVV",N.type="number",N.addEventListener("input",(()=>{u.checkCvvField(N),T?.hasChildNodes()&&void 0!==T.childNodes[1]&&T.removeChild(T.childNodes[1])})),T.append(N),P.append(x,T),C.append(E,P),g.append(f,C),v.append(h,g);const q=document.createElement("button");q.className="confirm-button",q.innerText="Confirm";const I=document.createElement("button");return I.className="close-button",I.innerText=" ",I.addEventListener("click",(()=>{this.cart.toggleModal()})),q.addEventListener("click",(()=>{const e=document.querySelectorAll(".modul-input");for(let t=0;t<e.length;t++){const s=e[t],i=s.parentElement;void 0!==e[t]&&(e[t]?.classList.contains("input-name")&&i?this.addErrorMessage(i,s,u.checkTextField(s,2,3)):e[t]?.classList.contains("input-phone")&&i?this.addErrorMessage(i,s,u.checkPhoneField(s)):e[t]?.classList.contains("input-address")&&i?this.addErrorMessage(i,s,u.checkTextField(s,3,5)):e[t]?.classList.contains("input-email")&&i?this.addErrorMessage(i,s,u.checkEmailField(s)):e[t]?.classList.contains("input-number")&&i?this.addErrorMessage(i,s,u.checkCardField(s)):e[t]?.classList.contains("input-date")&&i?this.addErrorMessage(i,s,u.checkDateField(s)):e[t]?.classList.contains("input-cvv")&&i&&this.addErrorMessage(i,s,u.checkCvvField(s)))}0===document.querySelectorAll(".modal-error").length&&(setTimeout((()=>{t.innerHTML="Thanks for your order!",t.classList.add("greetings")}),700),setTimeout((()=>{this.cart.clearCart(),this.cart.isOpenModal=!1,window.location.hash=m.ProductListPage}),3700))})),t.append(e,s,v,q,I),this.container.append(t),this.container}addErrorMessage(t,e,s){if(t.innerHTML="",t.append(e),!s){const e=document.createElement("div");e.className="modal-error",e.innerText="Error! Please enter correct data",t.append(e)}}}class f extends e{constructor(t,e){super(t),this.limitInputHandler=t=>{const e=t.target;+e.value<1&&(e.value="1"),this.cart.updateOpts("limit",+e.value),this.cart.checkEpmptyPage()},this.cart=e}updateCurrentPage(){this.container.querySelector(".current-page").textContent=`Page: ${this.cart.opts.page}`}prevPageHandler(){this.cart.decPage()}nextPageHandler(){this.cart.incPage()}updateCartItems(){const t=this.container.querySelector(".cart-items");t.innerHTML="";const e=this.cart.opts.page,s=this.cart.opts.limit,i=(+e-1)*s,a=e*s;this.cart.items.forEach(((e,s)=>{s>=i&&s<a&&t.append(new n("div","cart-item",this.cart,e,s+1).render())}))}render(){const{page:t,limit:e}=this.cart.opts,s=`\n      <div class='cart-wrap'>\n        <div class='products-in-cart'>\n          <div class='top-section'>\n            <h3>Products in Cart</h3>\n            <div>\n              <label for='limit'>\n                Limit\n                <input id='limit' type='number' value='${e}'>\n              </label>\n              <button class='prev-page'> < </button>\n              <span class='current-page'>Page: ${t} / ${Math.ceil(this.cart.items.length/e)}</span>\n              <button class='next-page'> > </button>\n            </div>\n          </div>\n          <div class='cart-items-wrap'>\n          </div>\n        </div>\n        <div class='summary-wrap'></div>\n      </div>\n    `;this.container.innerHTML=s;const i=this.container.querySelector(".cart-items-wrap"),n=new a("div","cart-items",this.cart).render();i?.append(n),this.container.querySelector(".summary-wrap")?.append(new o("div","summary",this.cart).render());const r=this.container.querySelector(".prev-page"),c=this.container.querySelector(".next-page"),d=this.container.querySelector("#limit");r?.addEventListener("click",(()=>this.prevPageHandler())),c?.addEventListener("click",(()=>this.nextPageHandler())),d?.addEventListener("input",(t=>this.limitInputHandler(t))),0===this.cart.items.length&&(this.container.querySelector(".cart-wrap").innerHTML="Oops - Cart is Empty((");const l=new g("modal",this.cart).render();return this.cart.isOpenModal&&l.classList.add("open"),this.container.append(l),this.container}}class L extends i{constructor(t,e,s){super(t,e),this.products=s}render(){const t=`\n      <div>\n        <select id=sort>\n          <option value='Price-ASC'>Price ASC</option>\n          <option value='Price-DESC'>Price DESC</option>\n          <option value='Rating-ASC'>Rating ASC</option>\n          <option value='Rating-DESC'>Rating DESC</option>\n        </select>\n        <input id='filter' type='text' placeholder='Search product' autofocus >\n      </div>\n      <div class='products-amount'>Products: ${this.products.items?.length}</div>\n      <div class='view-buttons'>\n        <button id='grid' class='grid-view' data-view='grid'></button>\n        <button id='list' class='line-view' data-view='list'></button>\n      </div>\n    `;this.container.innerHTML=t;const e=this.container.querySelector(".view-buttons"),s=e.querySelectorAll("button");(()=>{const t=this.products.opts.view;t?this.container.querySelector(`#${t}`)?.classList.add("active"):s[0]?.classList.add("active")})(),e?.addEventListener("click",(t=>{const e=t.target;e.matches("button")&&(s.forEach((t=>t.classList.remove("active"))),e.classList.add("active"),this.products.updateOpts("view",e.dataset.view))})),this.container.querySelectorAll("option").forEach((t=>{t.value===this.products.opts.sort&&(t.selected=!0)}));const i=this.container.querySelector("#sort");i.addEventListener("change",(()=>{this.products.updateOpts("sort",i.value)}));const n=this.container.querySelector("input");return this.products.opts.search&&(n.value=this.products.opts.search),n?.addEventListener("input",(t=>{const e=t.target;this.products.updateOpts("search",e.value,["dual-block","filter-block"])})),this.container}}class y extends i{constructor(t,e,s,i){super(t,e),this.item=s,this.cart=i}render(){const t=t=>!!this.cart.items.find((e=>e.id===t)),{title:e,price:s,rating:i,images:n,id:a}=this.item,r=`\n      <div class='img-wrap'>\n      </div>\n      <div class='products-description'>\n        <h3>${e.slice(0,20)}</h3>\n        <p>Rate: ${i}</p>\n        <div class='bottom-bar'>\n            <button class='add-product-button'>Add</button>\n            <p class='price'>${s} $</p>\n        </div>\n      </div>\n    `;this.container.innerHTML=r;const c=this.container.querySelector(".img-wrap");let o;const d=n[0];y.cacheImages[d]?o=y.cacheImages[d]:(o=new Image,o.src=d,y.cacheImages[d]=o),c.append(o);const l=this.container.querySelector("button"),p=this.container.querySelector("h3"),h=()=>{t(a)?(l.classList.add("active"),l.textContent="Added ✓"):(l.classList.remove("active"),l.textContent="Add")};return h(),l?.addEventListener("click",(()=>{t(a)?this.cart.removeItem(a):this.cart.addItem(this.item),h()})),o.addEventListener("click",(()=>{const t=`product-details/${a}`;window.location.hash=t})),p.addEventListener("click",(()=>{const t=`product-details/${a}`;window.location.hash=t})),this.container}}y.cacheImages={};class b extends i{constructor(t,e,s,i){super(t,e),this.products=s,this.cart=i}render(){const t=this.products.items;0===t.length?(this.container.innerHTML="Oops - No products!!!)",this.container.className="",this.container.classList.add("no-products")):t.forEach((t=>{const e=new y("div","product-card",t,this.cart).render();this.container.append(e)}));const e=this.products.opts.view;return e?this.container.classList.add(e):this.container.classList.add("grid"),this.container}}class w extends i{constructor(t,e,s){super(t,e),this.products=s}render(){this.container.innerHTML="\n      <div class='reset-copy'>\n        <button class='reset-filters'>Reset Filters</button>\n        <button class='copy-link'>Copy Link</button>\n      </div>\n    ";const t=this.container.querySelector(".reset-filters"),e=this.container.querySelector(".copy-link");return t?.addEventListener("click",(()=>this.products.resetOpts())),e?.addEventListener("click",(()=>{this.products.copiedURL=window.location.href,navigator.clipboard.writeText(window.location.href),e.classList.add("active")})),this.container}}class C extends i{constructor(t,e,s,i){super(t,e),this.products=i,this.filterBy=s}render(){const t=this.products.initialItems?.map((t=>t[this.filterBy])),e=[...new Set(t)],s=document.createElement("h3");s.textContent=this.filterBy;const i=document.createElement("form");return i.classList.add("filter-form"),e.forEach((t=>{const e=document.createElement("div");e.classList.add("filter-item");const s=this.products.opts[this.filterBy]?.split("↕").some((e=>e===t)),n=this.products.initialItems?.filter((e=>e[this.filterBy]===t)).length,a=this.products.items?.filter((e=>e[this.filterBy]===t)).length;a||e.classList.add("hide");const r=`\n        <input type='checkbox' ${s?"checked":""} id='${t}'>\n        <label for='${t}'>${t}</label>\n        <span>${a} / ${n}</span>\n      `;e.innerHTML=r,i.append(e)})),i.addEventListener("click",(t=>{const e=t.target,s=t.currentTarget;if(e.matches("input")){const t=[...s.querySelectorAll("input")].filter((t=>t.checked)).map((t=>t.id));if(0===t.length)this.products.updateOpts(this.filterBy,"",["dual-block","filter-block"]);else{const e=t.join("↕");this.products.updateOpts(this.filterBy,e,["dual-block","filter-block"])}}})),this.container.append(s),this.container.append(i),this.container}}class E extends i{constructor(t,e,s,i){super(t,e),this.products=i,this.filterBy=s}getRange(t,e){return`${t.value}↕${e.value}`}updateOpts(t){this.products.updateOpts(this.filterBy,t,["filter-block"])}render(){const t=this.products.initialItems?.map((t=>t[this.filterBy])),e=Math.max(...t),s=Math.min(...t),i=this.products.items?.map((t=>t[this.filterBy])),n=Math.max(...i),a=Math.min(...i);let r=null,c=null;this.products.opts[this.filterBy]&&([r,c]=this.products.opts[this.filterBy]?.split("↕").map((t=>+t)));const o=`\n    <div class="range_container">\n      <h3>${this.filterBy}</h3>\n      <div class="control-wrap">\n      <div class="form_control">\n      <div class="form_control_container">\n          <input \n            class="form_control_container__time__input" \n            type="number" \n            id="fromInput" \n            value="${a||r||s}"\n            min="${s}" \n            max="${e}"/>\n      </div>\n      <div class="form_control_container">\n          <input \n            class="form_control_container__time__input" \n            type="number" \n            id="toInput" \n            value="${n||c||e}"\n            min="${s}" \n            max="${e}"/>\n      </div>\n      </div>\n      <div class="sliders_control">\n      <input id="fromSlider" type="range" value="${a||r||s}" min="${s}" max="${e}"/>\n      <input id="toSlider" type="range" value="${n||c||e}" min="${s}" max="${e}"/>\n      </div>\n      </div>\n    </div>\n    `;function d(t,e){return[parseInt(t.value,10),parseInt(e.value,10)]}function l(t,e,s,i,n){const a=+e.max-+e.min,r=+t.value-+e.min,c=+e.value-+e.min;n.style.background=`linear-gradient(\n        to right,\n        ${s} 0%,\n        ${s} ${r/a*100}%,\n        ${i} ${r/a*100}%,\n        ${i} ${c/a*100}%, \n        ${s} ${c/a*100}%, \n        ${s} 100%)`}function p(t,e){+t.value<=+t.min?e.style.zIndex="2":e.style.zIndex="0"}this.container.innerHTML=o;const h=(t,e,s)=>{const[i,n]=d(t,e);l(t,e,"#C6C6C6","#0075ff",e),i>n?(t.value=`${n}`,s.value=`${n}`):s.value=`${i}`;const a=this.getRange(t,e);this.updateOpts(a)},u=(t,e,s)=>{const[i,n]=d(t,e);l(t,e,"#C6C6C6","#0075ff",e),p(e,e),i<=n?(e.value=`${n}`,s.value=`${n}`):(s.value=`${i}`,e.value=`${i}`);const a=this.getRange(t,e);this.updateOpts(a)},m=this.container.querySelector("#fromSlider"),v=this.container.querySelector("#toSlider"),g=this.container.querySelector("#fromInput"),f=this.container.querySelector("#toInput");return l(m,v,"#C6C6C6","#0075ff",v),p(v,v),m.oninput=()=>h(m,v,g),v.oninput=()=>u(m,v,f),g.oninput=()=>function(t,e,s,i){const[n,a]=d(e,s);l(e,s,"#C6C6C6","#0075ff",i),n>a?(t.value=`${a}`,e.value=`${a}`):t.value=`${n}`}(m,g,f,v),f.oninput=()=>function(t,e,s,i){const[n,a]=d(e,s);l(e,s,"#C6C6C6","#0075ff",i),p(s,t),n<=a?(t.value=`${a}`,s.value=`${a}`):s.value=`${n}`}(v,g,f,v),this.container}}function S(t,e){const s=document.createElement(t);return s.classList.add(e),s}class $ extends e{constructor(t,e,s){super(t),this.products=e,this.cart=s}render(){const t=new w("div","filter-bar",this.products).render(),e=S("div","filter-blocks-wrap"),s=S("div","dualfilter-blocks-wrap"),i=new C("div","filter-block","category",this.products).render(),n=new C("div","filter-block","brand",this.products).render(),a=new E("div","dual-filter","price",this.products).render(),r=new E("div","dual-filter","stock",this.products).render();e.append(i),e.append(n),s.append(a),s.append(r),t.append(e),t.append(s);const c=document.createElement("div");c.classList.add("product-section");const o=document.createElement("div");o.classList.add("products-wrap");const d=new b("div","product-list",this.products,this.cart).render();o.append(d);const l=new L("div","products-list-topbar",this.products).render();return c.append(l),c.append(o),this.container.append(t),this.container.append(c),this.container.classList.add("product-list-wrapper"),this.container}}$.textObject={MainTitle:"Product List Page"};const k=[{id:m.ProductListPage,text:"Products Page"}];class P extends i{renderPageButtons(){const t=document.createElement("nav");t.classList.add("nav"),k.forEach((({id:e,text:s})=>{const i=document.createElement("a");i.href=`#${e}`,i.innerText=s,i.classList.add("nav-link"),t.append(i)})),this.container.append(t)}renderTotalPrice(){const t=S("div","header-total-price");t.textContent="Cart Total: 000$",this.container.append(t)}renderCartLink(){const t=S("div","cart-link"),e=S("div","item-count");e.textContent="0",t.append(e),t.onclick=()=>window.location.hash=m.CartPage,this.container.append(t)}render(){return this.renderPageButtons(),this.renderTotalPrice(),this.renderCartLink(),this.container}}class x extends e{constructor(t,e){super(t),this.errorType=e}render(){const t=this.createHeaderTitle(x.textObject[this.errorType]);return this.container.append(t),this.container}}function T(t,e){const s=[...e];switch(t){case"Price-ASC":return s.sort(((t,e)=>t.price-e.price));case"Price-DESC":return s.sort(((t,e)=>e.price-t.price));case"Rating-ASC":return s.sort(((t,e)=>t.rating-e.rating));case"Rating-DESC":return s.sort(((t,e)=>e.rating-t.rating));default:return e}}function N(t,e){let s=[...t];return"number"!=typeof+e||isNaN(+e)?(console.log("SEARCH STRING"),s=s.filter((({title:t,description:s,brand:i,category:n})=>-1!==`${t} ${s} ${i} ${n}`.indexOf(e)))):(console.log("SEARCH NUMBER"),s=s.filter((({price:t,stock:s})=>{const i=+e;return i===t||i===s}))),console.log(s),s}x.textObject={404:"404 - The Page not found!("};class q{constructor(){this.initialItems=null,this.items=null,this.render=null,this.opts={},this.copiedURL="",this.cart=null}initProducts(t){this.initialItems=[...t],this.items=[...t];const e=new URL(window.location.href).searchParams,s={};for(const[t,i]of e.entries())s[t]=i;this.opts=s,this.updateItems()}addOpts(t,e){e?this.opts[t]=e:("search"===t&&(this.items=[...this.initialItems]),delete this.opts[t])}updateURL(){const t=new URL(window.location.href),e=new URLSearchParams(this.opts);t.search=e.toString(),window.history.pushState({},"",t.href)}updateProductAmount(){document.querySelector(".products-amount").textContent=`Products: ${this.items?.length}`}updateItems(){let t=[...this.initialItems];for(const e of Object.keys(this.opts))if("sort"===e)t=T(this.opts[e],t);else if("search"===e)t=N(t,this.opts[e]);else if("category"===e||"brand"===e){const s=this.opts[e]?.split("↕");t=t.filter((t=>s?.some((s=>s===t[e]))))}else if("price"===e||"stock"===e){const[s,i]=this.opts[e]?.split("↕").map((t=>+t));t=t.filter((t=>{const n=t[e];return n>=s&&n<=i}))}else if("view"===e){const t=this.opts[e],s=document.querySelector(".product-list");"list"===t?(s?.classList.remove("grid"),s?.classList.add("list")):"grid"===t&&(s?.classList.remove("list"),s?.classList.add("grid"))}this.items=t}updateOpts(t,e,s){this.addOpts(t,e),this.updateItems(),this.updateURL(),this.checkCopiedURL(),this.updateProductAmount();const i=new b("div","product-list",this,this.cart).render(),n=document.querySelector(".products-wrap");n.innerHTML="",n.appendChild(i),s?.forEach((t=>{if("dual-block"===t){const t=document.querySelector(".dualfilter-blocks-wrap");t.innerHTML="";const e=new E("div","dual-filter","price",this).render(),s=new E("div","dual-filter","stock",this).render();t.append(e),t.append(s)}else if("filter-block"===t){const t=document.querySelector(".filter-blocks-wrap");t.innerHTML="";const e=new C("div","filter-block","category",this).render(),s=new C("div","filter-block","brand",this).render();t.append(e),t.append(s)}}))}resetOpts(){this.opts={},this.updateURL(),this.items=[...this.initialItems],this.render&&this.render(m.ProductListPage)}checkCopiedURL(){const t=document.querySelector(".copy-link");window.location.href!==this.copiedURL&&t?.classList.remove("active")}bindCart(t){this.cart=t}bindRender(t){this.render=t}}class I{constructor(){this.updateItemNumbers=()=>{document.querySelectorAll(".cart-item-number").forEach(((t,e)=>t.textContent=`${e+1}`))},this.items=[],this.isOpenModal=!1,this.opts={page:1,limit:3},this.appliedCodes=[],this.promocode={rs22:20,css:10,js:15}}toggleModal(){this.isOpenModal=!this.isOpenModal;const t=document.querySelector("#modal");console.log(t),this.isOpenModal?t.classList.add("open"):t.classList.remove("open")}getTotalDiscount(){return this.appliedCodes.reduce(((t,e)=>t+(this.promocode[e]||0)),0)}getDiscountPrice(){const t=this.getTotalPrice(),e=this.getTotalDiscount();return Math.round(t-t/100*e)}removePromoCode(t){this.appliedCodes=this.appliedCodes.filter((e=>e!==t)),this.updateSummary()}setPromoCode(t){-1===this.appliedCodes.indexOf(t)&&this.appliedCodes.push(t),this.updateSummary(),document.querySelector(".applied-codes-wrap")?.classList.remove("hide")}updateSummary(){if(!this.items.length)return;const t=document.querySelector(".summary-products"),e=document.querySelector(".summary-total"),s=document.querySelector(".summary-discount");t.textContent=`Products: ${this.getTotalCount()}`,e.textContent=`Total: ${this.getTotalPrice()}$`,s.textContent=`Total: ${this.getDiscountPrice()}$`;const i=document.querySelector(".applied-items");i.innerHTML="",this.appliedCodes.forEach((t=>{const e=new r("div",t,this).render();i?.append(e)})),0===this.appliedCodes.length?(document.querySelector(".applied-codes-wrap")?.classList.add("hide"),e?.classList.remove("disable"),s?.classList.add("hide")):(e?.classList.add("disable"),s?.classList.remove("hide")),document.querySelector(".promo-add-button")?.classList.remove("hide")}updateOpts(t,e){this.opts[t]=e,this.updateURL(),this.updateCartItems()}updateURL(){const t=new URL(window.location.href),e=new URLSearchParams({page:`${this.opts.page}`,limit:`${this.opts.limit}`});t.search=e.toString(),window.history.pushState({},"",t.href)}updateCartItems(){if(0!==this.items.length){const t=Math.ceil(this.items.length/this.opts.limit);document.querySelector(".current-page").textContent=`Page: ${this.opts.page} / ${t}`;const e=document.querySelector(".cart-items-wrap");e.innerHTML="";const s=new a("div","cart-items",this).render();e?.append(s)}}getTotalPrice(){return this.items.reduce(((t,e)=>t+e.price*(e.cnt||1)),0)}getTotalCount(){return this.items.reduce(((t,e)=>t+(e.cnt||1)),0)}checkEmptyCart(){if(0===this.items.length){const t=document.querySelector(".cart-wrap");t&&(t.innerHTML="Oops - Cart is Empty((")}}updateHeader(){const t=document.querySelector(".item-count");document.querySelector(".header-total-price").textContent=`Cart Total: ${this.getTotalPrice()}$`,t.textContent=`${this.getTotalCount()}`}incPage(){const t=this.items.length,e=this.opts.limit,s=Math.ceil(t/e);this.opts.page<s&&this.updateOpts("page",this.opts.page+1)}decPage(){this.opts.page>1&&this.updateOpts("page",this.opts.page-1)}initCart(){const t=localStorage.getItem("cart");this.items=t?JSON.parse(t):[];const e=localStorage.getItem("promocodes");this.appliedCodes=e?JSON.parse(e):[];const s=new URL(window.location.href).searchParams,i={page:+(s.get("page")||"1"),limit:+(s.get("limit")||"3")};this.opts=i,this.updateHeader(),window.addEventListener("beforeunload",(()=>{localStorage.setItem("cart",JSON.stringify(this.items)),localStorage.setItem("promocodes",JSON.stringify(this.appliedCodes))}))}incItem(t){const e=this.items.findIndex((e=>e.id===t)),s=this.items[e];s.cnt&&s.cnt<s.stock&&(s.cnt+=1),this.saveCart(),this.updateHeader(),this.updateSummary()}decItem(t){const e=this.items.findIndex((e=>e.id===t));if(-1===e)return;const s=this.items[e];s.cnt&&(s.cnt-=1),0===s.cnt&&(this.removeItem(t),this.updateCartItems(),this.checkEpmptyPage()),this.saveCart(),this.updateHeader(),this.updateSummary()}checkEpmptyPage(){const{page:t,limit:e}=this.opts,s=Math.ceil(this.items.length/e);if(t>s){const t=s;this.updateOpts("page",t||1)}}addItem(t){t.cnt=1,this.items.push(t),this.saveCart(),this.updateHeader()}removeItem(t){this.items=this.items.filter((e=>e.id!==t)),this.saveCart(),this.updateHeader(),this.checkEmptyCart()}saveCart(){localStorage.setItem("cart",JSON.stringify(this.items))}clearCart(){this.items=[],this.appliedCodes=[],this.updateHeader(),localStorage.clear()}}class M extends i{constructor(t){super("div","rating-star"),this.rating=t}render(){const t=this.rating/5*100;return this.container.style.backgroundImage=`linear-gradient(to right, #fec524 0%, #fec524 ${t}%, white ${t}%, white 100%)`,this.container}}class H extends e{constructor(t,e,s,i){super(t),this.id=e,this.products=s,this.cart=i}checkId(){return this.products.initialItems.some((({id:t})=>t===this.id))}render(){if(this.checkId()){const t=this.products.items?.find((t=>t.id===this.id)),{price:e,title:s,category:i,brand:n,images:a,description:r,discountPercentage:c,rating:o,stock:d}=t,l=t=>!!this.cart.items.find((e=>e.id===t)),p=`\n        <div class='container'>\n          <h2 class='product-details-title'>${s}</h2>\n          <ul class='breadcrumbs'>\n            <li>STORE</li>\n            <li>>></li>\n            <li>${i}</li>\n            <li>>></li>\n            <li>${n}</li>\n            <li>>></li>\n            <li>${s}</li>\n          </ul>\n          <div class='product-details'>\n            <div class='product-images'>\n              <div class='thumbnails-bar'></div>\n              <div class='big-image-wrap'>\n                <img class='big-image' src='${a[0]}'>\n              </div>\n            </div>\n            <div class='product-info'>\n              <div class='detail-block'>\n                <h3 class='detail-title'>Description</h3>\n                <p class='detail-description'>${r}</p>\n                <p class='detail-info'>Brand: <span>${n}</span></p>\n                <p class='detail-info'>Category: <span>${i}</span></p>\n                <p class='detail-info'>Discount Percentage: <span>${c}%</span></p>\n                <p class='detail-info'>Rating: <span>${o}</span></p>\n                <div class='rating-star-wrap'></div>\n                <p class='detail-info'>Stock: <span>${d}</span></p>\n                <div class='bottom-wrap'>\n                  <div class='detail-buttons'>\n                    <button class='add-button'>Add to Cart</button>\n                    <button class='buy-now'>Buy Now</button>\n                  </div>\n                  <div class='detail-price'>${e}$</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      `;this.container.innerHTML=p;const h=this.container.querySelector(".rating-star-wrap"),u=this.container.querySelector(".thumbnails-bar"),v=this.container.querySelector(".big-image"),g=this.container.querySelector(".add-button"),f=this.container.querySelector(".buy-now");h?.append(new M(o).render()),a.forEach((async(t,e)=>{const s=document.createElement("div");s.classList.add("thumbnail"),0===e&&s.classList.add("active");const i=await(n=t,new Promise((t=>{const e=new Image;e.addEventListener("load",(()=>{t(e)})),e.src=n})).catch((t=>console.log("!!!!!!!!!!!!",t))));var n;i.addEventListener("click",(()=>{v.src=t,this.container.querySelectorAll(".thumbnail").forEach((t=>t.classList.remove("active"))),s.classList.add("active")})),s.append(i),u?.append(s)}));const L=()=>{l(this.id)?(g.classList.add("active"),g.textContent="Added ✓"):(g.classList.remove("active"),g.textContent="Add")};L();const y=()=>{l(this.id)?this.cart.removeItem(this.id):this.cart.addItem(t),L()},b=()=>{this.cart.isOpenModal=!0,l(this.id)||this.cart.addItem(t),window.location.hash=m.CartPage};g.addEventListener("click",y),f?.addEventListener("click",b)}else this.container.innerHTML="The Product does not exist!(";return this.container}}class O extends i{render(){return this.container.innerHTML="\n      <div class='link-block'>\n        <a href='https://github.com/batar-btr' class='git-link'>batar-btr</a>\n        <a href='https://github.com/AlexPirko' class='git-link'>AlexPirko</a>\n      </div>\n      <span>2023</span>\n      <a href='https://rs.school/js/' class='rs-link'></a>\n    ",this.container}}class R{constructor(){this.renderNewPage=t=>{const e=document.querySelector(`#${R.defaultPageId}`);e&&e.remove();let i=null;if(t===m.HomePage)i=new s(t);else if(t===m.CartPage)i=new f(t,this.cart);else if(t===m.ProductListPage)i=new $(t,this.products,this.cart);else if(t.match(new RegExp(m.ProductDetails))){const e=+t.split("/")[1];i=new H(m.ProductDetails,e,this.products,this.cart)}else i=new x(t,v.Error_404);if(i instanceof $&&this.products.updateURL(),i){const t=i.render();t.id=R.defaultPageId,R.container.querySelector("main").append(t)}},this.products=new q,this.cart=new I,this.header=new P("header","header"),this.footer=new O("footer","footer")}async loadData(){fetch("https://dummyjson.com/products?limit=100").then((t=>t.json())).then((t=>{this.cart.initCart(),this.products.initProducts(t.products),this.products.bindRender(this.renderNewPage),this.products.bindCart(this.cart);const e=window.location.hash.slice(1);""===e?window.location.hash=m.ProductListPage:this.renderNewPage(e)}))}enableRouteChange(){window.addEventListener("hashchange",(()=>{const t=new URL(window.location.href);t.search="",window.history.pushState({},"",t.href);const e=window.location.hash.slice(1);this.renderNewPage(e)}))}createBaseMarkUp(){const t=this.header.render(),e=document.createElement("main"),s=this.footer.render();R.container.append(t,e,s)}run(){this.enableRouteChange(),this.loadData(),this.createBaseMarkUp()}}R.container=document.querySelector("#root"),R.defaultPageId="current-page",(new R).run()})();